---
phase: 01-foundation
plan: 04
type: execute
wave: 3
depends_on:
  - "01-01"
  - "01-02"
  - "01-03"
files_modified: []
autonomous: false
requirements:
  - DIST-01
  - AUTH-01
  - AUTH-02
  - AUTH-03

must_haves:
  truths:
    - "Plugin loads successfully with claude --plugin-dir and /adi:setup is visible"
    - "Full setup flow works: user enters org URL, project, PAT and receives success confirmation"
    - "Validation feedback is accurate: success message confirms org and project, error messages match the error type"
    - "Re-run /adi:setup shows masked current values and accepts partial updates"
    - "/adi:help lists all available commands"
  artifacts:
    - path: ".claude-plugin/plugin.json"
      provides: "Plugin manifest — must exist for plugin to load"
    - path: "skills/setup/SKILL.md"
      provides: "Setup skill — must be discoverable as /adi:setup"
    - path: "skills/help/SKILL.md"
      provides: "Help skill — must be discoverable as /adi:help"
    - path: "scripts/setup.mjs"
      provides: "Setup script — invoked by skill"
    - path: "scripts/config.mjs"
      provides: "Config manager — required by setup.mjs"
    - path: "scripts/ado-client.mjs"
      provides: "API client — required by setup.mjs"
  key_links:
    - from: "skills/setup/SKILL.md"
      to: "scripts/setup.mjs"
      via: "bash command in skill body invoking setup.mjs"
      pattern: "setup\\.mjs"
    - from: "scripts/setup.mjs"
      to: "scripts/ado-client.mjs"
      via: "validateConnection import"
      pattern: "validateConnection"
---

<objective>
Verify the complete Phase 1 foundation works end-to-end. The executor runs the plugin locally, exercises the setup flow with real credentials (or a known-invalid token to test error paths), and confirms all Phase 1 requirements are met.

Purpose: Human verification that the plugin loads, skills are discoverable, setup flow is interactive and correct, validation feedback is accurate, and re-run works. This is the gate before Phase 2 builds on this foundation.
Output: Confirmed working Phase 1 foundation.
</objective>

<execution_context>
@C:/Users/7N_TSM/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/7N_TSM/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify complete Phase 1 end-to-end</name>
  <files></files>
  <action>
Human verification of complete Phase 1 plugin foundation:
- Plugin manifest (plugin.json) declaring `adi` namespace
- Marketplace descriptor (marketplace.json) for two-step install
- Shared scripts: config.mjs (config read/write/mask) and ado-client.mjs (API client with error classification)
- Setup script: setup.mjs (validates connection, writes config, outputs JSON)
- Skills: /adi:setup (interactive config flow) and /adi:help (command listing)
- README with correct install commands and skill reference

**Step 1: Load plugin locally**

In a terminal at the repo root:
```bash
claude --plugin-dir .
```

Confirm that `/adi:setup` and `/adi:help` appear as available commands (check with `/adi:help`).

---

**Step 2: Test /adi:help**

Run: `/adi:help`

Expected: A table or list showing `/adi:setup` and `/adi:help` with descriptions, plus coming-soon entries for future skills.

---

**Step 3: Test /adi:setup — happy path**

Run: `/adi:setup`

Expected flow:
1. Claude asks for org URL (e.g. `https://dev.azure.com/my-org`)
2. Claude asks for project name
3. Claude asks for PAT, with inline guidance showing required scopes and a link to Azure DevOps PAT settings
4. After entering valid credentials: Claude reports "Connected to [org/project]. Config saved to ~/.adi/config.json — keep this file private. You're ready — try /adi:pr-metrics"

Verify `~/.adi/config.json` was created and contains the correct values (PAT stored as plaintext).

---

**Step 4: Test /adi:setup — error paths**

Test with a bad PAT (random string):
- Expected: Claude reports PAT was rejected (auth error) and re-prompts for the PAT — does NOT restart from scratch

Test with a bad org URL (e.g. `https://dev.azure.com/nonexistent-org-xyz-test-12345`):
- Expected: Claude reports the org URL is unreachable (network/404 error) and re-prompts for the org URL

---

**Step 5: Test /adi:setup — re-run flow**

With config already saved, run `/adi:setup` again.

Expected:
1. Claude shows current config with PAT masked (first 4 + last 4 chars, asterisks in middle)
2. Claude asks which field to update (org URL / project name / PAT / all)
3. Select one field — Claude only re-prompts that field, keeping others from existing config
4. After updating, validation runs again and shows success message

---

**Step 6: Check README**

Open README.md and confirm:
- Install commands use `/plugin marketplace add` and `/plugin install` — NOT `claude plugin add github:`
- Both `/adi:setup` and `/adi:help` are documented
- Privacy note about `~/.adi/config.json` is present
  </action>
  <verify>
    <manual>All 6 steps above pass as described.</manual>
  </verify>
  <done>All Phase 1 requirements verified: plugin loads, /adi:setup full flow works, validation feedback is accurate, re-run shows masked values and accepts partial updates, /adi:help lists commands, README uses correct install commands.</done>
  <resume-signal>
Type "approved" if all steps pass.
Describe any failures if steps do not pass (e.g., "Step 3 failed: PAT prompt missing scope guidance").
  </resume-signal>
</task>

</tasks>

<verification>
All six verification steps pass:
1. Plugin loads with --plugin-dir, /adi:setup and /adi:help discoverable
2. /adi:help shows correct command listing
3. Happy path: valid credentials saved, confirmation message correct
4. Error paths: auth and network errors produce correct messages, re-prompt without restart
5. Re-run: shows masked current values, accepts partial field update
6. README: correct install commands, no wrong command, privacy note present
</verification>

<success_criteria>
Phase 1 complete when:
1. Plugin loads locally without errors
2. /adi:setup full flow works (prompts, validation, save, confirmation)
3. /adi:setup re-run works (shows current masked values, partial update)
4. /adi:setup error handling works (distinct messages for network/auth/permission, re-prompts failed field)
5. /adi:help lists commands correctly
6. ~/.adi/config.json created with correct content
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md` documenting:
- Verification results for each step
- Any issues found and how they were resolved
- Confirmation that Phase 1 foundation is ready for Phase 2
</output>
